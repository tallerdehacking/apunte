<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/main.ddfbf41cc15c16add8b3d14df7854d6638589653939d95d9cf5fe4d3daf5bf79bfe19fe129947c9b826d71d46a6ebe6511885864fd42d2dabe157092d30cf1a8.css integrity="sha512-3fv0HMFcFq3Ys9FN94VNZjhYllOTnZXZz1/k09r1v3m/4Z/hKZR8m4JtcdRqbr5lEYhYZP1C0tq+FXCS0wzxqA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Wireshark - Taller de Hacking Competitivo</title><meta name=description content="DCC universidad de Chile"><link rel=canonical href=/docs/forense/wireshark/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/logo_redondo.png"><meta name=twitter:title content="Wireshark"><meta name=twitter:description content="Algunos problemas de tipo CTF de categoría forense requieren analizar logs de tráfico de red, los cuales suelen guardarse con la aplicación Wireshark. En esta sección describiremos brevemente algunos conceptos relacionados con el modelo de Internet y luego explicaremos algunas funcionalidades de Wireshark.
Modelo de Internet Tambien conocido como Modelo TCP/IP, considera varios componentes que permiten el intercambio de información entre dispositivos conectados a una red.
Las capas del modelo son las siguientes:"><meta name=twitter:site content="@dccuchile"><meta name=twitter:creator content="@dccuchile"><meta property="og:title" content="Wireshark"><meta property="og:description" content="Algunos problemas de tipo CTF de categoría forense requieren analizar logs de tráfico de red, los cuales suelen guardarse con la aplicación Wireshark. En esta sección describiremos brevemente algunos conceptos relacionados con el modelo de Internet y luego explicaremos algunas funcionalidades de Wireshark.
Modelo de Internet Tambien conocido como Modelo TCP/IP, considera varios componentes que permiten el intercambio de información entre dispositivos conectados a una red.
Las capas del modelo son las siguientes:"><meta property="og:type" content="article"><meta property="og:url" content="/docs/forense/wireshark/"><meta property="og:image" content="/logo_redondo.png"><meta property="article:published_time" content="2020-10-06T08:48:45+00:00"><meta property="article:modified_time" content="2021-05-23T20:56:33-04:00"><meta property="og:site_name" content="Taller de Hacking Competitivo"><meta property="article:publisher" content="https://www.facebook.com/DCCUChile"><meta property="article:author" content="https://www.facebook.com/DCCUChile"><meta property="og:locale" content="es_CL"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"\/"},{"@type":"ListItem","position":2,"name":"Docsforensewireshark","item":"\/docsforensewireshark\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="docs single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 mr-auto" href=/><img class=logo-light src=/images/banner.svg></img>
<img class=logo-dark src=/images/banner_dark.svg></img></a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/cc5325/apunte><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ml-2 sr-only">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=/blog/>Videos</a></li><li class=nav-item><a class=nav-link href=/docs/prologo/intro>Apunte</a></li><li class=nav-item><a class=nav-link href=/writeups/misc/registro_htb>Writeups</a></li><li class=nav-item><a class=nav-link href=/tareas/>Evaluaciones</a></li><li class=nav-item><a class=nav-link href=/acerca>Acerca</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Buscar Documentación..." aria-label="Buscar Documentación..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Prólogo</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/prologo/intro/>Prólogo</a></li></ul><h3>Esteganografía</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/stego/intro/>Intro a la Esteganografía</a></li><li><a class=docs-link href=/docs/stego/conceptos-basicos/>Conceptos Básicos</a></li><li><a class=docs-link href=/docs/stego/cripto-clasica/>Criptografía Clásica</a></li><li><a class=docs-link href=/docs/stego/stego/>Stego en texto, imágenes y audio</a></li><li><a class=docs-link href=/docs/stego/ejercicios/>Ejercicios de Stego</a></li></ul><h3>Criptografía Moderna</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/cripto-moderna/intro/>Intro a Criptografía Moderna</a></li><li><a class=docs-link href=/docs/cripto-moderna/hashing/>Hashing</a></li><li><a class=docs-link href=/docs/cripto-moderna/cripto-simetrica/>Criptografía Simétrica</a></li><li><a class=docs-link href=/docs/cripto-moderna/cripto-asimetrica/>Criptografía Asimétrica</a></li><li><a class=docs-link href=/docs/cripto-moderna/ejercicios/>Ejercicios Cripto Moderna</a></li></ul><h3>Aplicaciones Web</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/apps-web/intro/>Intro a Aplicaciones Web</a></li><li><a class=docs-link href=/docs/apps-web/tecnicas-basicas/>Técnicas Básicas de Análisis Web</a></li><li><a class=docs-link href=/docs/apps-web/xss/>Cross-Site Scripting</a></li><li><a class=docs-link href=/docs/apps-web/inyecciones/>Inyecciones</a></li><li><a class=docs-link href=/docs/apps-web/rce/>Remote Code Execution</a></li><li><a class=docs-link href=/docs/apps-web/reverse-shell/>Reverse Shell</a></li><li><a class=docs-link href=/docs/apps-web/cve/>Common Vulnerabilities and Exposures</a></li><li><a class=docs-link href=/docs/apps-web/ejercicios/>Ejercicios Apps Web</a></li></ul><h3>Análisis Forense</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/forense/intro/>Introducción al Análisis Forense</a></li><li><a class=docs-link href=/docs/forense/cmd-logs/>Comandos, Logs y Configuraciones</a></li><li><a class=docs-link href=/docs/forense/versionado-recuperacion/>Versionado y Recuperación de Archivos</a></li><li><a class="docs-link active" href=/docs/forense/wireshark/>Wireshark</a></li><li><a class=docs-link href=/docs/forense/ejercicios/>Ejercicios de Forense</a></li></ul><h3>Ingeniería Reversa</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/reversa/intro/>Intro a la Ingeniería Reversa</a></li><li><a class=docs-link href=/docs/reversa/decompiling/>Decompilación</a></li><li><a class=docs-link href=/docs/reversa/deobfuscation/>Deobfuscación</a></li><li><a class=docs-link href=/docs/reversa/ejercicios/>Ejercicios Reversing</a></li></ul><h3>Pwning</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/pwning/intro/>Intro al Pwning</a></li><li><a class=docs-link href=/docs/pwning/permisos-linux/>Permisos de Usuario en Linux</a></li><li><a class=docs-link href=/docs/pwning/escalamiento-privilegios/>Escalamiento de Privilegios</a></li><li><a class=docs-link href=/docs/pwning/buffer-overflow/>Buffer Overflow</a></li><li><a class=docs-link href=/docs/pwning/ejercicios/>Ejercicios de Pwning</a></li></ul><h3>OSINT</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/osint/intro/>Intro a OSINT</a></li><li><a class=docs-link href=/docs/osint/google/>Google Hacking</a></li><li><a class=docs-link href=/docs/osint/github/>Búsqueda en Github</a></li><li><a class=docs-link href=/docs/osint/theharvester/>The Harvester</a></li><li><a class=docs-link href=/docs/osint/haveibeenpwned/>Have I Been Pwned</a></li><li><a class=docs-link href=/docs/osint/shodan/>Shodan</a></li><li><a class=docs-link href=/docs/osint/ejercicios/>Ejercicios OSINT</a></li></ul><h3>Anexos</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/anexos/herramientas/>Herramientas</a></li><li><a class=docs-link href=/docs/anexos/vpn/>Configuración de VPN</a></li><li><a class=docs-link href=/docs/anexos/kali/>Kali Linux</a></li><li><a class=docs-link href=/docs/anexos/proxy/>Proxy</a></li><li><a class=docs-link href=/docs/anexos/comandos/>Comandos de Terminal de Linux</a></li><li><a class=docs-link href=/docs/anexos/referencias/>Referencias</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>Contenidos</h3><nav id=TableOfContents><ul><li><a href=#modelo-de-internet>Modelo de Internet</a></li><li><a href=#interfaces-de-red>Interfaces de Red</a></li><li><a href=#wireshark>Wireshark</a><ul><li><a href=#uso-general-de-wireshark>Uso general de Wireshark</a></li><li><a href=#análisis-de-protocolos>Análisis de protocolos</a></li><li><a href=#otros-protocolos-revisables-con-wireshark>Otros protocolos revisables con Wireshark</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Wireshark</h1><p class=lead></p><p>Algunos problemas de tipo CTF de categoría forense requieren analizar logs de tráfico de red, los cuales suelen guardarse con la aplicación Wireshark. En esta sección describiremos brevemente algunos conceptos relacionados con el modelo de Internet y luego explicaremos algunas funcionalidades de Wireshark.</p><h2 id=modelo-de-internet>Modelo de Internet<a href=#modelo-de-internet class=anchor aria-hidden=true>#</a></h2><p>Tambien conocido como Modelo TCP/IP, considera varios componentes que permiten el intercambio de información entre dispositivos conectados a una red.</p><p>Las capas del modelo son las siguientes:</p><ul><li><strong>Capa de Enlace</strong>: Capa que agrupa protocolos de comunicación que permiten conectar físicamente a un dispositivo a la red.<ul><li><em>Ejemplos de Protocolos</em>: <em>Ethernet</em>, <em>Wi-Fi</em>, <em>ARP</em>, <em>NDP</em>, <em>OSPF</em>, etc.</li></ul></li><li><strong>Capa de Red o Internet</strong>: Capa que agrupa protocolos de comunicación que se utilizan para transportar paquetes de información entre equipos conectados a la red.<ul><li><em>Ejemplos de protocolos</em>: <em>IPv4</em>, <em>IPv6</em>, <em>ICMP</em>, etc.</li></ul></li><li><strong>Capa de Transporte</strong>: Capa que entrega servicios de comunicación entre dispositivos a aplicaciones<ul><li><em>Ejemplos de protocolos</em>: <em>TCP</em>, <em>UDP</em>, etc.</li></ul></li><li><strong>Capa de Aplicación</strong>: Capa en la que se agrupan todas las aplicaciones que se ejecutan entre dispositivos.<ul><li><em>Ejemplos de protocolos</em>: <em>HTTP</em>, <em>DNS</em>, <em>IMAP</em>, <em>FTP</em>, etc.</li></ul></li></ul><p>La imagen siguiente (elaborada por <code>Cburnett</code> y subida a <a href=https://en.wikipedia.org/wiki/Internet_protocol_suite#/media/File:UDP_encapsulation.svg>Wikimedia Commons</a>) muestra cómo cada capa &ldquo;envuelve&rdquo; los datos de las capas superiores, en el caso concreto de uso de protocolo de transporte <em>UDP</em>.</p><p><img src=../UDP_encapsulation.svg alt="Encapsulación en el caso del protocolo UDP"></p><h2 id=interfaces-de-red>Interfaces de Red<a href=#interfaces-de-red class=anchor aria-hidden=true>#</a></h2><p>Corresponden a dispositivos reales o virtuales por los cuales viajan paquetes de comunicación.</p><p>En Kali, pueden listar estos dispositivos con el comando <code>ip link show</code>. Este comando debería mostrarles algo parecido a esto:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class=m>1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc pfifo_fast state UP mode DEFAULT group default qlen <span class=m>1000</span>
    link/ether 08:00:27:a6:1f:86 brd ff:ff:ff:ff:ff:ff
</code></pre></div><ul><li>La interfaz <code>lo</code> corresponde a una <em>interfaz virtual</em> denominada <code>loopback</code> y usada para enrutar paquetes a la misma máquina sin necesidad de otras interfaces.</li><li>La interfaz <code>eth0</code> desde el punto de vista de Kali se comporta como una <em>interfaz real</em>, es decir, correspondería a una tarjeta de red independiente en el caso de un sistema operativo no emulado.</li></ul><p>Cada una de las interfaces anteriores posee una <em>Dirección MAC</em>, un conjunto de 6 bytes único en cada subred utilizado para enrutar paquetes en la capa de enlace. Al mismo tiempo, cada interfaz bien configurada debiese poseer una <em>Dirección IP</em>, la que le permite enrutar paquetes en la capa de red.</p><h2 id=wireshark>Wireshark<a href=#wireshark class=anchor aria-hidden=true>#</a></h2><p><a href=https://www.wireshark.org/>Wireshark</a> es una herramienta de código abierto que permite capturar y analizar tráfico de protocolos de red. En esta parte del apunte veremos cómo utilizarla para interceptar paquetes del stack de internet y otros protocolos populares.</p><h3 id=uso-general-de-wireshark>Uso general de Wireshark<a href=#uso-general-de-wireshark class=anchor aria-hidden=true>#</a></h3><p>Wireshark se puede instalar con el gestor de paquetes de Kali Linux:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo apt install wireshark
</code></pre></div><p>Luego, podrán encontrar el ícono en el menú de aplicaciones. Para ejecutar Wireshark, se les solicitará la contraseña de superusuario, dado que es necesaria para poder monitorear las interfaces de red.</p><p>Al iniciar Wireshark, se encontrarán con esta vista:</p><p><img src=../forensics-1.png alt></p><p>En la lista del centro, se observan las distintas interfaces presentes en el computador, además de una especial, denominada <code>any</code>, la cual agrupa todos los resultados de las demás interfaces.</p><p>Si hacen click en una interfaz (por ejemplo, <code>eth0</code>), verán la siguiente pantalla.</p><p><img src=../forensics-2.png alt></p><p>En el número (1) encontrarán los distintos paquetes interceptados por Wireshark, mientras que en (2) verán el paquete disecado, capa por capa, y en (3) verán el contenido del paquete como <em>hexdump</em>. Métanse por ejemplo a <code>https://cc5325.xor.cl</code> mientras Wireshark está funcionando y luego vuelvan a Wireshark. Les aparecerá algo así:</p><p><img src=../forensics-3.png alt></p><p>En la imagen se alcanzan a ver 3 etapas de la consulta a la página web del curso:</p><ul><li><strong>Consultas DNS</strong>, en color celeste, representan las llamadas al resolver DNS del computador para determinar la IP asociada al dominio cc5325.xor.cl.</li><li><strong>Paquetes TCP</strong>: En gris y morado, Se conectan con la IP indicada en el paso anterior, para inicializar una conexión con el servidor</li><li><strong>Paquetes TLS</strong>: En morado, corresponden a los paquetes usados para la transmisión de los contenidos de la página. No podemos ver su contenido en texto plano porque TLS es una conexión cifrada.</li></ul><h3 id=análisis-de-protocolos>Análisis de protocolos<a href=#análisis-de-protocolos class=anchor aria-hidden=true>#</a></h3><p>A continuación veremos algunos ejemplos de uso básicos de Wireshark, los cuales consideran su inicialización, el uso de filtros de visualización y la exportación de archivos y datos.</p><h4 id=filtros-básicos>Filtros básicos<a href=#filtros-básicos class=anchor aria-hidden=true>#</a></h4><p>Partamos revisando un caso básico de comunicación. Hablaremos con el servidor de la tarea 2. Para ello, hay que recordar que es necesario conectarse primero a la VPN del CEC y luego abrir la interfaz <code>any</code> en el menú inicial, de forma de ver mezclados paquetes de todas las interfaces (<code>eth0</code> y <code>tun0</code>, la segunda generada cuando se realiza la conexión OpenVPN.)</p><p>Luego, podemos intentar ejecutar el comando <code>nc server.cc5325.xor.cl 25102</code>, enviar un mensaje y recibir una respuesta. Ahora podemos revisar Wireshark para ver los paquetes enviados en este intercambio:</p><p><img src=../forensics-2021-05-23-00-21-00.png alt></p><p>Lo primero que notamos de la situación anterior es que se han enviado y recibido varios tipos de paquetes. para lo que nos puede servir aprender a usar los <em>filtros de visualización de Wireshark</em> (Ctrl+/). A continuación mostramos algunos ejemplos.</p><ul><li><strong>Filtrar por puerto de origen/destino</strong>: Para filtrar por puerto de origen o destino con un protocolo que usa <code>tcp</code> en la capa de transporte, se puede escribir en la barra de direcciones <code>tcp.port</code> seguido de un comparador (<code>></code>, <code>==</code>, <code>&lt;</code>) y luego del valor de puerto contra el cual se quiere comparar. Si se quiere filtrar solo por puerto de origen, usar el filtro <code>tcp.srcport</code> y si se quiere filtrar solo por puerto de destino, usar <code>tcp.dstport</code>. Análogamente existen filtros para protocolos que usen <code>udp</code>.</li><li><strong>Filtrar por IP de origen/destino</strong>: Para filtrar por IP de origen o destino se usa el filtro <code>ip.addr</code>. Para filtrar solo por IP de origen, se usa <code>ip.src</code> y para filtrar solo por IP de destino se usa <code>ip.dst</code>.</li></ul><p>Es posible componer los filtros con operadores lógicos (<code>&& / and</code>, <code>|| / or</code>, <code>! / not</code>):</p><ul><li><strong>Ejemplo</strong>: !(udp.port == 53) && ip.src == 127.0.0.1</li></ul><p>Más información de los filtros se puede encontrar en <a href=https://wiki.wireshark.org/DisplayFilters>esta documentación</a></p><h4 id=revisar-y-exportar-contenido>Revisar y exportar contenido<a href=#revisar-y-exportar-contenido class=anchor aria-hidden=true>#</a></h4><p>A continuación se muestra los mensajes enviados y recibidos en la terminal con <code>netcat</code>.</p><p><img src=../forensics-2021-05-23-01-03-01.png alt></p><p>De los mensajes anteriores, se puede ver esta captura de paquetes por Wireshark. Si nos fijamos en el tercer recuadro, notaremos que logramos interceptar el mensaje en texto plano enviado por el servidor a nuestra terminal.</p><p><img src=../forensics-2021-05-23-01-04-07.png alt></p><p>Lo anterior incluso sirve con protocolos más sofisticados, como HTTP. Para revisar esto, naveguemos en Firefox dentro de kali a la URL <a href=http://info.cern.ch/>http://info.cern.ch/</a>. Luego, filtremos por visualización paquetes tcp al puerto 80 y revisemos el contenido del mensaje. En la siguiente imágen podemos ver parte de la consulta HTTP de nuestra máquina virtual al servidor remoto:</p><p><img src=../forensics-2021-05-23-01-26-42.png alt></p><p>Las flechas al lado de la consulta (en la columna No.) muestran cómo los paquetes se relacionan entre sí. En específico, nos indican que el paquete 2459 es la respuesta de la consulta hecha en el paquete 2457 (los números en sus Wireshark definitivamente variarán, ya que los paquetes se enumeran desde que se lanza la herramienta). Los otros paquetes cubiertos por la línea vertical son mensajes de capas más bajas (TCP en este caso).</p><p>En la parte inferior del paquete 2459 se puede ver parte del HTML de la página cargada en texto plano.</p><p><img src=../forensics-2021-05-23-01-28-20.png alt></p><p>Si quisieramos extraer esta página (o el archivo PNG del paquete) podemos hacer click derecho en el payload del paquete (última fila de la vista del cuadro intermedio) y hacer click en <em>Export Packet Bytes</em> (o usar el acceso directo de teclado <em>Ctrl+Shift+X</em>). Luego elegir una ubicación para el archivo. Si lo guardamos con la extensión correcta, podremos abrirlo sin problemas después.</p><p><img src=../forensics-2021-05-23-01-36-33.png alt></p><h4 id=guardar-un-archivo-de-captura>Guardar un archivo de captura<a href=#guardar-un-archivo-de-captura class=anchor aria-hidden=true>#</a></h4><p>Podemos guardar todos los paquetes capturados en la sesión ejecutando <code>File -> Save As...</code>, lo que nos permitirá exportar un archivo con extensión <code>.pacpng</code>. Luego podremos abrir este archivo en Wireshark y seguir analizándolo, o incluso compartirlo.</p><h4 id=seguir-un-stream-de-datos>Seguir un stream de datos<a href=#seguir-un-stream-de-datos class=anchor aria-hidden=true>#</a></h4><p>Si quieres tener en un solo archivo todo un flujo de comunicación (<em>stream</em>), puedes hacer click derecho en el <em>frame</em>, luego en <em>follow</em> y luego en la capa que deseas seguir. Por ejemplo, lo siguiente sigue el flujo de obtener el <code>index</code> de la página web:</p><p><img src=../forensics-2021-05-23-01-49-39.png alt></p><h4 id=https-y-protocolos-cifrados>HTTPS y protocolos cifrados<a href=#https-y-protocolos-cifrados class=anchor aria-hidden=true>#</a></h4><p>Al inicio de esta sección vimos que a veces los paquetes viajan cifrados entre cliente y servidor. Esto quiere decir que se necesita de una llave que permita descifrar los datos que llegan y se van. Esta llave la suele manejar el mismo navegador al momento de realizar la conexión. Sin embargo, es posible configurar algunos navegadores para que exporten la llave.</p><p>Cabe destacar que en los CTF de forensics que no requieren romper algún tipo de cifrado obsoleto usado para la comunicación, se les suele entregar la llave que usa el navegador para desencriptar y encriptar los datos enviados, la cual luego puede configurarse en Wireshark para ser usada en el análisis de los paquetes.</p><p>A continuación veremos tanto como iniciar nuestro navegador para que esta llave se exporte, como qué hay que hacer para configurar Wireshark para que utilice esta llave.</p><ul><li><p><strong>Iniciar el navegador con la capacidad de loguear en un archivo sus llaves TLS</strong>. Últimamente Firefox tiene problemas para configurarse con este modo, por lo que les recomendamos instalar (<code>sudo apt install chromium</code>) y ejecutar Chromium con el siguiente comando:</p><ul><li><code>SSLKEYLOGFILE=~/key.log chromium</code></li></ul></li><li><p><strong>Navegar a algún sitio con HTTPS</strong>, como por ejemplo, <a href=https://dcc.uchile.cl>dcc.uchile.cl</a></p></li><li><p><strong>Importar llaves en Wireshark</strong></p></li></ul><p>Abrir Wireshark y luego ir a <code>Edit -> Preferences</code>. Verás este menú:</p><p><img src=../forensics-2021-05-23-15-42-32.png alt></p><p>En <code>Protocols -> TLS</code> ir a (Pre)-Master-Secret log filename y seleccionar el archivo que debiese estar en <code>/home/kali/key.log</code>.</p><p><img src=../forensics-2021-05-23-15-44-14.png alt></p><p>Ahora si vamos a la interfaz <code>any</code> y visitamos el sitio web del DCC, veremos que aparte de los paquetes TLS, sí aparecen paquetes de tipo HTTP, los cuales son completamente explorables.</p><p><img src=../forensics-2021-05-23-15-47-18.png alt></p><h3 id=otros-protocolos-revisables-con-wireshark>Otros protocolos revisables con Wireshark<a href=#otros-protocolos-revisables-con-wireshark class=anchor aria-hidden=true>#</a></h3><p>Como se puede ver en el menú &ldquo;Protocols&rdquo; de las preferencias, los protocolos soportados por Wireshark son muchos. A continuación mostraremos algunos.</p><ul><li><strong>USB</strong>: Es posible generar archivos de captura de la comunicación realizada entre un dispositivo USB y el computador. Para esto, basta con seguir <a href=https://gitlab.com/wireshark/wireshark/-/wikis/CaptureSetup/USB>este tutorial</a>. Probablemente sea necesario también revisar la <a href=https://gitlab.com/wireshark/wireshark/-/wikis/USB>documentación</a> del protocolo USB en general y del dispositivo que estamos revisando.</li><li><strong>Bluetooth</strong>: También es posible capturar mensajes Bluetooth entre nuestro computador y otro dispositivo usando <a href=https://gitlab.com/wireshark/wireshark/-/wikis/CaptureSetup/Bluetooth>esta guía</a>. Puede ser necesario revisar la <a href=https://gitlab.com/wireshark/wireshark/-/wikis/Bluetooth>documentación</a> del protocolo Bluetooth.</li></ul><p class=edit-page><a href=https://github.com/cc5325/apunte/blob/main/content/docs/forense/wireshark.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Editar en GitHub</a>
<span class=date-info><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Modificado por última vez el 23/05/2021 a las 20:56:33 hrs.</span></p><div class="docs-navigation d-flex justify-content-between"><a href=/docs/apps-web/rce/><div class="card my-1"><div class="card-body py-2">&larr; Remote Code Execution</div></div></a><a class=ml-auto href=/docs/forense/ejercicios/><div class="card my-1"><div class="card-body py-2">Ejercicios de Forense &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Sitio generado con <a href=https://gohugo.io/>Hugo</a> y <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-right"><ul class=list-inline><a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target=_blank rel="license noopener noreferrer" style=display:inline-block>CC BY-SA 4.0<img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></ul></div></div></div></footer><script src=/main.2507c05f91ee016250e43b67b3d342f5a0d9d4dc5264f76cdc4518cd36a9e04cf3022ce8362802e618d8130b6733b53ee845a49e67229eeb3d3e70347db96a2b.js integrity="sha512-JQfAX5HuAWJQ5Dtns9NC9aDZ1NxSZPds3EUYzTap4EzzAizoNigC5hjYEwtnM7U+6EWknmcinus9PnA0fblqKw==" crossorigin=anonymous defer></script><script src=/index.min.8d37d4806058b94e5c9fe3710b209aa9f078f69b67b2caf997a8ad956e79064c58c43b06094271a5ce458da6944af254e6b21852391f87b81fcd45e72f106ef8.js integrity="sha512-jTfUgGBYuU5cn+NxCyCaqfB49ptnssr5l6itlW55BkxYxDsGCUJxpc5FjaaUSvJU5rIYUjkfh7gfzUXnLxBu+A==" crossorigin=anonymous defer></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};window.addEventListener('load',(event)=>{document.querySelectorAll("mjx-container").forEach(function(x){x.parentElement.classList+='has-jax'})});</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>